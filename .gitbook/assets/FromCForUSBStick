<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>Installation/FromCForUSBStick - Community Help Wiki</title>
<script type="text/javascript" src="/moin_static198/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin_static198/light/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin_static198/light/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/moin_static198/light/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static198/light/css/msie.css">
<![endif]-->


<link rel="alternate" title="Community Help Wiki: Installation/FromCForUSBStick" href="/community/Installation/FromCForUSBStick?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Installation%2FFromCForUSBStick&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/community/CommunityHelpWiki">
<link rel="Alternate" title="Wiki Markup" href="/community/Installation/FromCForUSBStick?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/community/Installation/FromCForUSBStick?action=print">
<link rel="Up" href="/community/Installation">
<link rel="Search" href="/community/FindPage">
<link rel="Index" href="/community/TitleIndex">
<link rel="Glossary" href="/community/WordIndex">
<link rel="Help" href="/community/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="https://partners.ubuntu.com">Partners</a> </li>
        	    <li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
        	    <li><a href="https://community.ubuntu.com">Community</a></li>
        	    <li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
                    <li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a class="nbinfo" href="/community/Installation/FromCForUSBStick?action=info" rel="nofollow">Page History</a></li><li><a href="/community/Installation/FromCForUSBStick?action=login&amp;login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 <form action="http://www.google.com/cse" id="cse-search-box">
   <div>
     <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />
     <input type="hidden" name="ie" value="UTF-8" />
     <input type="text" name="q" size="21" />
     <input type="submit" name="sa" value="Search" />
   </div>
 </form>
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><span class="pagepath"><a href="/community/Installation">Installation</a></span><span class="sep">/</span><a href="/community/Installation/FromCForUSBStick">FromCForUSBStick</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear" />
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div dir="ltr" id="Tag.2FUnsupported.content" lang="en"><span class="anchor" id="Tag.2FUnsupported.top"></span>
<span class="anchor" id="Tag.2FUnsupported.line-1"></span><div><table style="width: 80%;  margin: 0.5em auto;"><tbody><tr>  <td style="border: none;  padding: 1em 0.5em 0 0.9em;  border-top-left-radius: 1em;  border-bottom-left-radius: 1em; ; text-align: center; width: 8%; background-color: #eeeeee"><p class="line862"> <img alt="Tag/tag.png" class="attachment" src="/community/Tag?action=AttachFile&amp;do=get&amp;target=tag.png" title="Tag/tag.png" /> </td>
  <td style="padding: 0.8em 1em 0.2em 1em;  border: none;  border-top-right-radius: 1em;  border-bottom-right-radius: 1em; ; background-color: #F29DD3; vertical-align: top"><p class="line862"> <strong>Unsupported Version</strong> <br>
 This article applies to an unsupported version of Ubuntu. <a href="/community/Tag#Unsupported">More info...</a> </td>
</tr>
</tbody></table></div><span class="anchor" id="Tag.2FUnsupported.line-2"></span><span class="anchor" id="Tag.2FUnsupported.bottom"></span></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h2 id="How_to_install_from_CF_media.2FUSB_drive_using_the_.27.27grub.27.27_bootloader.">How to install from CF media/USB drive using the ''grub'' bootloader.</h2>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line862">I had been searching around for quite a while, without success, for a method to set up an Ubuntu installer to boot directly from a motherboard mounted Compact Flash drive. My goal was to have an installer that was fully <em>grub</em> compatible. The following is a write-up of the procedure. It was originally used to install <em>Feisty</em> but has been tested with <em>Gutsy</em> and should be easily adaptable for use with future releases. The procedure has been tested using the CF socket and Crucial Compact Flash memory as well as with USB memory sticks (Kingston Data Traveler, 1GB and 2GB and Crucial 1GB). <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">
<h2 id="Host_System">Host System</h2>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">The host system used to configure the installer comprised the following: <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><ul><li>Ubuntu Feisty Fawn. <span class="anchor" id="line-12"></span></li><li>Advantech PCM9381 motherboard <span class="anchor" id="line-13"></span></li><li>1.5GHz Celeron M CPU <span class="anchor" id="line-14"></span></li><li>1.0 GB Ram <span class="anchor" id="line-15"></span></li><li>100GB IDE hard disk on IDE Primary Master. <span class="anchor" id="line-16"></span></li><li>Integral Compact Flash socket on IDE Secondary Master. <span class="anchor" id="line-17"></span></li><li>3 USB 2.0 ports. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></li></ul><p class="line867">
<h2 id="Preliminaries">Preliminaries</h2>
<span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">Before anything else, the problem of finding the hardware designation for the <em>CF/USB</em> is paramount. You must be absolutely sure about this before starting. If you get this wrong, you may wipe out your entire system. Carefully examine the contents of each drive before starting and keep notes if necessary about which drive is which. You should also be aware that this assignment may change if different stuff is plugged in, or, indeed if things are connected in a different order. Also, note that the drive designator WILL change when you boot from the newly configured device: it will always be "hd0" if it is the boot device! <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><ul><li><p class="line891"><em>CF Socket</em>. Since this is wired as the IDE secondary master, I naively assumed that it would appear as hd2, given that I expected hd1 would be the unused IDE primary slave. I was wrong. The BIOS closes this "gap" and numbers the drives sequentially from 0 on up. Since this is the second drive the BIOS discovers, it appears as hd1. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span></li><li class="gap"><p class="line891"><em>USB Memory Stick</em>. After my experience with the CF socket, I was expecting the USB Stick to show up as hd1, and it did. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></li></ul><p class="line862">You should be aware that Ubuntu pretends that all drives are SCSI drives. Since I have only one hard drive and either the CF drive or the USB drive is installed (never both at the same time), the <em>CF/USB</em> drive shows up as "sdb" in Ubuntu's file browser (BUT as "hd1" in grub, which references hardware names, not driver names - Alas, there's no rest for the wicked.) I also tried to use a multi-slot/all in one USB card reader - from Crucial: Pocket Reader, model 1CR-T3-U28. There are 4 drives associated with this reader (sdc, sdd, sde, and sdf). The CF appeared on sdd. While I could freely access this drive from Ubuntu, I could never get the BIOS to boot from the external CF reader. If anyone figures out how to get this device to boot, please add instructions. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line867">
<h2 id="Step_By_Step_Instructions">Step By Step Instructions</h2>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">In the instruction that follow, all of the terminal input/output is indented, while my comments are at the margin. Also, since the procedure works for either the CF disk or the USB stick, I will refer to them both at the same time using the moniker <em>"CF/USB"</em>. For all of the following steps, you will need a root terminal. Start up the terminal application and enter: <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><ul><li style="list-style-type:none"><p class="line891"><tt>sbesch@hairpin:~$&nbsp;sudo&nbsp;su</tt><br>
 <span class="anchor" id="line-34"></span><tt>Password:Its_So_Obvious!</tt><br>
 <span class="anchor" id="line-35"></span><tt>root@hairpin:/home/sbesch#&nbsp;cd&nbsp;/</tt><br>
 <span class="anchor" id="line-36"></span><tt>root@hairpin:/#</tt> <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></li></ul><p class="line874">(My computer's name - hairpin - comes from the name of a characteristic loop of amino acids found in many proteins, not, as one might assume, from the common tonsorial object.) <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867">
<h3 id="Partition_Table.">Partition Table.</h3>
<span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line862">Step one is to get a partition table and a file system installed on the <em>CF/USB</em>. As far as I know, it is essential that the default file system that ships on most <em>CF/USB's</em> (FATxx) must be replaced. I tried valiantly to get grub to boot from a FATxx partition. It just wouldn't work. Why is a mystery. Grub patched in the correct <em>Stage1.5</em>, wrote the MBR, wrote the <em>Stage2</em> loader - all successfully. It just wasn't recognized as a bootable device by my BIOS. To repartition and install a file system, I used "fdisk" in the example. Since the <em>CF/USB</em> automounts when plugged in, you will need to unmount it first - just click on the drive icon that appears and select "unmount". Then run fdisk and have a look at the partition table of the drive (gparted is a lot easier if you have it installed. This is just more universal): <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/#&nbsp;fdisk&nbsp;/dev/sdb</tt><br>
 <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;p</tt><br>
 <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line891"><tt>Disk&nbsp;/dev/sdb:&nbsp;1039&nbsp;MB,&nbsp;1039933440&nbsp;bytes</tt><br>
 <span class="anchor" id="line-49"></span><tt>32&nbsp;heads,&nbsp;62&nbsp;sectors/track,&nbsp;1023&nbsp;cylinders</tt><br>
 <span class="anchor" id="line-50"></span><tt>Units&nbsp;=&nbsp;cylinders&nbsp;of&nbsp;1984&nbsp;*&nbsp;512&nbsp;=&nbsp;1015808&nbsp;bytes</tt><br>
 <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Device&nbsp;Boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Blocks&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;System</tt><br>
 <span class="anchor" id="line-53"></span><tt>sdb1&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1023&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1014785&nbsp;&nbsp;83&nbsp;&nbsp;Linux</tt><br>
 <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span></li></ul></li></ul><p class="line862">This is the table from my already partitioned CF. If you already have such a partition, then you are done with fdisk and can just enter "q" to exit. Note that the <em>Boot Flag</em> is set, as indicated by the "*" under the boot column. It must be set. If it's not, make sure that you set it before quitting (see below). If the drive is new, then there will probably be a FAT partition which will need to be removed. Enter "d" to delete the partition. If there is only one partition, it will just delete it. If there is more than one you will be asked to choose: <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;d</tt><br>
 <span class="anchor" id="line-58"></span><tt>Selected&nbsp;partition&nbsp;1</tt><br>
 <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></li></ul><p class="line874">Then create the new partition using the "n" command: <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;n</tt><br>
 <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line891"><tt>Command&nbsp;action</tt><br>
 <span class="anchor" id="line-65"></span><tt>&nbsp;&nbsp;&nbsp;e&nbsp;&nbsp;&nbsp;extended</tt><br>
 <span class="anchor" id="line-66"></span><tt>&nbsp;&nbsp;&nbsp;p&nbsp;&nbsp;&nbsp;primary&nbsp;partition&nbsp;(1-4)</tt><br>
 <span class="anchor" id="line-67"></span><tt>p</tt><br>
 <span class="anchor" id="line-68"></span><tt>Partition&nbsp;number&nbsp;(1-4):&nbsp;1</tt><br>
 <span class="anchor" id="line-69"></span><tt>First&nbsp;cylinder&nbsp;(1-1023,&nbsp;default&nbsp;1):&nbsp;1</tt><br>
 <span class="anchor" id="line-70"></span><tt>Last&nbsp;cylinder&nbsp;or&nbsp;+size&nbsp;or&nbsp;+sizeM&nbsp;or&nbsp;+sizeK&nbsp;(1-1023,&nbsp;default&nbsp;1023):</tt><br>
  <span class="anchor" id="line-71"></span><tt>Using&nbsp;default&nbsp;value&nbsp;1023</tt><br>
 <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span></li></ul><p class="line874">Once the tables are set up, use the "a" command to set the "Boot" flag on the first partition: <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;a</tt><br>
 <span class="anchor" id="line-76"></span><tt>Partition&nbsp;number&nbsp;(1-4):&nbsp;1</tt><br>
 <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span></li></ul><p class="line874">Note that you can set up more than one partition if you like. In fact, I do this with the 2GB USB drives so that I can have a more universal (i.e., FAT) file system on the unused part of the drive. The installer files require about 800 MB, so on the USB drive I have a partition table like this: <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;p</tt><br>
 <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line891"><tt>Disk&nbsp;sdb:&nbsp;2041&nbsp;MB,&nbsp;2041577472&nbsp;bytes</tt><br>
 <span class="anchor" id="line-83"></span><tt>255&nbsp;heads,&nbsp;63&nbsp;sectors/track,&nbsp;248&nbsp;cylinders</tt><br>
 <span class="anchor" id="line-84"></span><tt>Units&nbsp;=&nbsp;cylinders&nbsp;of&nbsp;16065&nbsp;*&nbsp;512&nbsp;=&nbsp;8225280&nbsp;bytes</tt><br>
 <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line891"><tt>Device&nbsp;Boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Blocks&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;System</tt><br>
 <span class="anchor" id="line-87"></span><tt>&nbsp;&nbsp;sdb1&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;819283+&nbsp;&nbsp;83&nbsp;&nbsp;Linux</tt><br>
 <span class="anchor" id="line-88"></span><tt>&nbsp;&nbsp;sdb2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;103&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;248&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1172745&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;FAT16</tt><br>
 <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span></li></ul><p class="line874">Up to now, nothing we have done has had any effect on the real table. If you've made any mistakes, or if you just want to start over, use the "q" command to quit without writing the new table. Otherwise, when you are ready, use the "w" command to write the table and make it take effect: <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><ul><li style="list-style-type:none"><p class="line891"><tt>Command&nbsp;(m&nbsp;for&nbsp;help):&nbsp;w</tt><br>
 <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line891"><tt>The&nbsp;partition&nbsp;table&nbsp;has&nbsp;been&nbsp;altered!</tt><br>
 <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line891"><tt>Calling&nbsp;ioctl()&nbsp;to&nbsp;re-read&nbsp;partition&nbsp;table.</tt><br>
 <span class="anchor" id="line-97"></span><tt>Syncing&nbsp;disks.</tt><br>
 <span class="anchor" id="line-98"></span><tt>root@hairpin:/#</tt><br>
 <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span></li></ul><p class="line874">That's it. The table is written and ready to go. The "w" command also exits fdisk.  <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line867">
<h3 id="Making_the_File_System">Making the File System</h3>
<span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line862">Next, we need a file system. I'm going to use ext2/3 (if you use <em>gparted</em>, the file system can be created directly when the partition is set up): <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/#&nbsp;mkfs&nbsp;-t&nbsp;ext2&nbsp;/dev/sdb1</tt><br>
 <span class="anchor" id="line-107"></span><tt>mke2fs&nbsp;1.40-WIP&nbsp;(14-Nov-2006)</tt><br>
 <span class="anchor" id="line-108"></span><tt>Filesystem&nbsp;label=</tt><br>
 <span class="anchor" id="line-109"></span><tt>OS&nbsp;type:&nbsp;Linux</tt><br>
 <span class="anchor" id="line-110"></span><tt>Block&nbsp;size=4096&nbsp;(log=2)</tt><br>
 <span class="anchor" id="line-111"></span><tt>Fragment&nbsp;size=4096&nbsp;(log=2)</tt><br>
 <span class="anchor" id="line-112"></span><tt>126976&nbsp;inodes,&nbsp;253696&nbsp;blocks</tt><br>
 <span class="anchor" id="line-113"></span><tt>12684&nbsp;blocks&nbsp;(5.00%)&nbsp;reserved&nbsp;for&nbsp;the&nbsp;super&nbsp;user</tt><br>
 <span class="anchor" id="line-114"></span><tt>First&nbsp;data&nbsp;block=0</tt><br>
 <span class="anchor" id="line-115"></span><tt>Maximum&nbsp;filesystem&nbsp;blocks=260046848</tt><br>
 <span class="anchor" id="line-116"></span><tt>8&nbsp;block&nbsp;groups</tt><br>
 <span class="anchor" id="line-117"></span><tt>32768&nbsp;blocks&nbsp;per&nbsp;group,&nbsp;32768&nbsp;fragments&nbsp;per&nbsp;group</tt><br>
 <span class="anchor" id="line-118"></span><tt>15872&nbsp;inodes&nbsp;per&nbsp;group</tt><br>
 <span class="anchor" id="line-119"></span><tt>Superblock&nbsp;backups&nbsp;stored&nbsp;on&nbsp;blocks:&nbsp;</tt><br>
 <span class="anchor" id="line-120"></span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32768,&nbsp;98304,&nbsp;163840,&nbsp;229376</tt><br>
 <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line891"><tt>Writing&nbsp;inode&nbsp;tables:&nbsp;done</tt><br>
 <span class="anchor" id="line-123"></span><tt>Creating&nbsp;journal&nbsp;(4096&nbsp;blocks):&nbsp;done</tt><br>
 <span class="anchor" id="line-124"></span><tt>Writing&nbsp;superblocks&nbsp;and&nbsp;filesystem&nbsp;accounting&nbsp;information:&nbsp;done</tt><br>
 <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line891"><tt>This&nbsp;filesystem&nbsp;will&nbsp;be&nbsp;automatically&nbsp;checked&nbsp;every&nbsp;34&nbsp;mounts&nbsp;or</tt><br>
 <span class="anchor" id="line-127"></span><tt>180&nbsp;days,&nbsp;whichever&nbsp;comes&nbsp;first.&nbsp;&nbsp;Use&nbsp;tune2fs&nbsp;-c&nbsp;or&nbsp;-i&nbsp;to&nbsp;override.</tt><br>
 <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></li></ul><p class="line874">If you've set up a second partition, you should put the filesystem on it now using mkfs or any of the other file system utilities (parted, gparted, etc). <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line867">
<h3 id="Mounting_the_Drive.">Mounting the Drive.</h3>
<span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line862">The next step is to mount the <em>CF/USB</em> drive so the necessary files can be copied onto it. Generally, simply removing the device and plugging it back in will force a mount. (If you're using <em>gparted</em>, its rather difficult to keep it from being mounted after almost any operation on the disk, so it's probably already mounted.) On the other hand, it's simple enough to mount it right from the command line.  First, you need a mount point. (This can be removed later with "<tt>rm&nbsp;-rf&nbsp;Bootie</tt>"): <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/#&nbsp;cd&nbsp;/media</tt><br>
 <span class="anchor" id="line-136"></span><tt>root@hairpin:/media#&nbsp;mkdir&nbsp;Bootie</tt><br>
 <span class="anchor" id="line-137"></span><tt>root@hairpin:/media#&nbsp;mount&nbsp;-t&nbsp;ext3&nbsp;/dev/sdb1&nbsp;/media/Bootie</tt><br>
 <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span></li></ul><p class="line867">
<h3 id="Copying_Needed_Files.">Copying Needed Files.</h3>
<span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line874">Change to the mounted media, make the needed directories and copy the grub loader files from your system disk: <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/media#&nbsp;cd&nbsp;Bootie</tt><br>
 <span class="anchor" id="line-144"></span><tt>root@hairpin:/media/Bootie#&nbsp;mkdir&nbsp;-p&nbsp;boot/grub</tt><br>
 <span class="anchor" id="line-145"></span><tt>root@hairpin:/media/Bootie#&nbsp;cp&nbsp;/boot/grub/*&nbsp;./boot/grub</tt><br>
 <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span></li></ul><p class="line874">The next thing is to get a suitable kernel and the initial ram-disk file system. It turns out that we need to be a bit careful here. We can't just take these from our system disk or any install CD. The installers on the CD's are tightly bound to the CD as the source medium and the installer gets very confused if you try to run the it from anything but the CD. However, Ubuntu supplies a customized kernel/initrd just for the purpose of installing from things like the CF or the USB disk. You get them from here: <span class="anchor" id="line-148"></span><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://archive.ubuntu.com/ubuntu/dists/feisty/main/installer-i386/current//images/hd-media/">http://archive.ubuntu.com/ubuntu/dists/feisty/main/installer-i386/current//images/hd-media/</a> <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></li></ul><p class="line862">Download both initrd.gz and vmlinuz from this site and place them in the "boot" folder just created on the <em>CF/USB</em> disk. Next, we need to get an install CD. The vmlinuz/initrd we just downloaded will look for an install CD ".iso" file on the install media and use it if one is found. We just need to download one to the root of the <em>CF/USB</em> disk. Simply go to the Ubuntu site and download the alternate CD (ubuntu-7.04-alternate-i386.iso) and copy it onto <tt>/media/Bootie</tt>. I also add an "id.txt" file to <tt>/media/Bootie</tt> (the root of the <em>CF/USB</em> disk) which simply contains the text "Feisty Installer". The idea of this file is to identify the purpose of the disk and the OS version, as well as to provide a unique file for identifying the drive in grub (see below). The file structure on the CF should now look like this: <span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><ul><li style="list-style-type:none"><p class="line891"><tt>/</tt><br>
 <span class="anchor" id="line-153"></span><tt>&nbsp;ubuntu-7.04-alternate-i386.iso</tt><br>
 <span class="anchor" id="line-154"></span><tt>&nbsp;id.txt</tt><br>
 <span class="anchor" id="line-155"></span><tt>&nbsp;boot/</tt><br>
 <span class="anchor" id="line-156"></span><tt>&nbsp;&nbsp;initrd.gz</tt><br>
 <span class="anchor" id="line-157"></span><tt>&nbsp;&nbsp;vmlinuz</tt><br>
 <span class="anchor" id="line-158"></span><tt>&nbsp;&nbsp;grub/</tt><br>
 <span class="anchor" id="line-159"></span><tt>&nbsp;&nbsp;&nbsp;....loader&nbsp;files</tt><br>
 <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></li></ul><p class="line874">While this example is for "feisty", I've also tested it with "gutsy". You just have to get the "7.10" alternate cd "iso" file and the matching set of installer files from: <span class="anchor" id="line-162"></span><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://archive.ubuntu.com/ubuntu/dists/gutsy/main/installer-i386/current//images/hd-media/">http://archive.ubuntu.com/ubuntu/dists/gutsy/main/installer-i386/current//images/hd-media/</a> <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></li></ul><p class="line874">In fact, when new versions arrive, all you should have to do is change vmlinuz/initrd, copy in the new alternate "iso" file and your ready to go. <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line867">
<h3 id="Configuring_.27.27grub.27.27">Configuring ''grub''</h3>
<span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line862">Next step is to set up the grub configuration file (menu.lst) located in <tt>/media/Bootie/boot/grub</tt>. <strong>MAKE SURE THAT YOU EDIT THE ONE ON THE CF/USB DISK!!</strong> Using gedit (or your favorite editor), open the file: <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/media/Bootie#&nbsp;gedit&nbsp;./boot/grub/menu.lst&nbsp;&amp;</tt><br>
 <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span></li></ul><p class="line862">Change the file so that it contains the following lines. Note that all the disk references are now set to the first partition on hd0 - this will in fact be the drive designation of the <em>CF/USB</em> when you boot from it: <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><pre><span class="anchor" id="line-1"></span>default         0
<span class="anchor" id="line-2"></span>timeout         3
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span>title   Install in Text Mode
<span class="anchor" id="line-5"></span>kernel  (hd0,0)/boot/vmlinuz fb=false video=vga16:off root=/dev/ram0 ramdisk_size=13000 quiet
<span class="anchor" id="line-6"></span>initrd  (hd0,0)/boot/initrd.gz
<span class="anchor" id="line-7"></span>
<span class="anchor" id="line-8"></span>title   Install in Expert Text Mode
<span class="anchor" id="line-9"></span>kernel  (hd0,0)/boot/vmlinuz fb=false video=vga16:off priority=low root=/dev/ram0 ramdisk_size=13000 quiet
<span class="anchor" id="line-10"></span>initrd  (hd0,0)/boot/initrd.gz
<span class="anchor" id="line-11"></span>
<span class="anchor" id="line-12"></span>title   Rescue a broken system
<span class="anchor" id="line-13"></span>kernel  (hd0,0)/boot/vmlinuz rescue/enable=true fb=false video=vga16:off root=/dev/ram0 ramdisk_size=13000 quiet
<span class="anchor" id="line-14"></span>initrd  (hd0,0)/boot/initrd.gz</pre><span class="anchor" id="line-191"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><p class="line862">Note that your browser may break up the <em>kernel</em> line. When you copy and paste them, make sure that the three directives (<em>title</em>, <em>kernel</em> and <em>initrd</em>) each land on one line (i.e., no embedded &lt;cr&gt;'s). The items in this menu are intended to allow you to choose between several options that are provided on the alternate CD. I have only tested the default installer ("Install in Text Mode") and cannot vouch for the functionality of either of the remaining 2 options. <span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><p class="line862">When done, close the file and unmount the <em>CF/USB</em> disk: <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:/media/Bootie#&nbsp;cd&nbsp;../..</tt><br>
 <span class="anchor" id="line-198"></span><tt>root@hairpin:/#umount&nbsp;/media/Bootie</tt><br>
 <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></li></ul><p class="line862">Note that it's important that you unmount the <em>CF/USB</em> disk before running grub. You may get away with it if you don't, but the documentation warns that this may cause "inconsistencies in the disk I/O" (whatever that means). <span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><p class="line867">
<h3 id="Installing_the_bootloader">Installing the bootloader</h3>
<span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line862">Now run grub to install the boot loader on the <em>CF/USB</em> disk: <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><ul><li style="list-style-type:none"><p class="line891"><tt>root@hairpin:#grub</tt><br>
 <span class="anchor" id="line-207"></span><tt>Probing&nbsp;devices&nbsp;to&nbsp;guess&nbsp;BIOS&nbsp;drives.&nbsp;This&nbsp;may&nbsp;take&nbsp;a&nbsp;long&nbsp;time.</tt><br>
 <span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span></li></ul><p class="line874">You probably won't see the previous line (at least for long enough to read it). While in grub, the terminal screen is replaced with the grub shell (below), hiding the initial response of grub. You will see it later when you exit grub. I've tried to illustrate the major points with some of the most useful grub features. Comments appear as appropriate. What follows then, is the grub dialog. <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line867"><hr /><p class="line874">Grub starts <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line867"><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><pre><span class="anchor" id="line-1-1"></span>               [ Minimal BASH-like line editing is supported.   For
<span class="anchor" id="line-2-1"></span>                 the   first   word,  TAB  lists  possible  command
<span class="anchor" id="line-3-1"></span>                 completions.  Anywhere else TAB lists the possible
<span class="anchor" id="line-4-1"></span>                 completions of a device/filename.  ESC at any time
<span class="anchor" id="line-5-1"></span>                 exits. ]</pre><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><p class="line874">The first thing to do is to absolutely confirm the correct drive designation. This is where the "id.txt" file comes in handy - providing of course that you don't foolishly place an identical file in the root of your system drive! We'll use grub's find command to locate the file: <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;find&nbsp;/id.txt</tt><br>
 <span class="anchor" id="line-224"></span><tt>&nbsp;(hd1,0)</tt><br>
 <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></li></ul><p class="line862">The response from grub - "(hd1,0)" - has just told us that the <em>CF/USB</em> disk partition that contains the installer is "(hd1,0)". It has also illustrated an important bit of syntax: drives are designated in parentheses as "(hdx,y)", where x is the drive number and y is the partition number. We'll use this info in the next 2 steps. <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line867">
<h4 id="Set_The_grub_root.">Set The grub root.</h4>
<span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><p class="line862">Next, we must set the grub "root". This is so that grub can make adjustments to the loader that it installs so that it will boot properly when the drive letters are later changed by the BIOS during the actual boot - remember, it's "(hd1,0)" now, but will be "(hd0,0)" at boot time. I've entered only root (hd&lt;tab&gt; to show how grub will list all available devices using &lt;tab&gt; completion. We don't want hd0! This is the main, 100GB drive on which Ubuntu is already installed. If we make this the root, then when our <em>CF/USB</em> drive boots it will try to find files on places that it shouldn't: <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;root&nbsp;(hd</tt><br>
 <span class="anchor" id="line-233"></span><tt>&nbsp;Possible&nbsp;disks&nbsp;are:&nbsp;&nbsp;hd0&nbsp;hd1</tt><br>
 <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span></li></ul><p class="line862">Next, I add "1,&lt;tab&gt;" to the command to see what partitions I have available: <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;root&nbsp;(hd1,</tt><br>
 <span class="anchor" id="line-238"></span><tt>&nbsp;Possible&nbsp;partitions&nbsp;are:</tt><br>
 <span class="anchor" id="line-239"></span><tt>&nbsp;&nbsp;&nbsp;Partition&nbsp;num:&nbsp;0,&nbsp;&nbsp;Filesystem&nbsp;type&nbsp;is&nbsp;ext2fs,&nbsp;partition&nbsp;type&nbsp;0x83</tt><br>
 <span class="anchor" id="line-240"></span><tt>&nbsp;&nbsp;&nbsp;Partition&nbsp;num:&nbsp;1,&nbsp;&nbsp;Filesystem&nbsp;type&nbsp;is&nbsp;fat,&nbsp;partition&nbsp;type&nbsp;0x6</tt><br>
 <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span></li></ul><p class="line862">I'm working with my USB device here, so there are 2 partitions. I want partition 0 (note that sdb1 is partition 0!). In the following command, I choose partition 0 by completing the command with "0)"&lt;cr&gt;. You may have only one partition, in which case grub will complete the line for you if you type a &lt;tab&gt;. I choose partition 0 by completing the command with "0)"&lt;cr&gt;: <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;root&nbsp;(hd1,0)</tt><br>
 <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span></li></ul><p class="line867">
<h4 id="Setup_and_Install_the_grub_Bootstrap_Code.">Setup and Install the grub Bootstrap Code.</h4>
<span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line862">Since I know that the grub loader files are on hd1,0 (I copied them onto the CF after all), next I'll let grub set itself up on hd1 (the <em>CF/USB</em> drive). We don't specify a partition here since we are setting up the boot loader in the Master Boot Record (MBR) which resides outside any partition: <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;setup&nbsp;(hd1)</tt><br>
 <span class="anchor" id="line-251"></span><tt>&nbsp;Checking&nbsp;if&nbsp;"/boot/grub/stage1"&nbsp;exists...&nbsp;yes</tt><br>
 <span class="anchor" id="line-252"></span><tt>&nbsp;Checking&nbsp;if&nbsp;"/boot/grub/stage2"&nbsp;exists...&nbsp;yes</tt><br>
 <span class="anchor" id="line-253"></span><tt>&nbsp;Checking&nbsp;if&nbsp;"/boot/grub/e2fs_stage1_5"&nbsp;exists...&nbsp;yes</tt><br>
 <span class="anchor" id="line-254"></span><tt>&nbsp;Running&nbsp;"embed&nbsp;/boot/grub/e2fs_stage1_5&nbsp;(hd1)"...&nbsp;&nbsp;17&nbsp;sectors&nbsp;are&nbsp;embedded.</tt><br>
 <span class="anchor" id="line-255"></span><tt>succeeded</tt><br>
 <span class="anchor" id="line-256"></span><tt>&nbsp;Running&nbsp;"install&nbsp;/boot/grub/stage1&nbsp;(hd1)&nbsp;(hd1)1+17&nbsp;p&nbsp;(hd1,0)/boot/grub/stage2&nbsp;/boot/grub/menu.lst"...&nbsp;succeeded</tt><br>
 <span class="anchor" id="line-257"></span><tt>Done.</tt><br>
 <span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span></li></ul><p class="line862">Notice what's happened. Grub has detected the filesystem type and patched the stage 2 loader with the stage 1.5 fragment. This teaches stage2 how to deal with the ext2 filesystem (that's the "embed" command). It has then copied the stage1 file to the MBR of the <em>CF/USB</em> disk and followed it with the (now patched) stage2. As far as grub is concerned, it's done. So now we just quit grub and return to the root command prompt. <span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><ul><li style="list-style-type:none"><p class="line891"><tt>grub&gt;&nbsp;quit</tt><br>
 <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span></li></ul><p class="line867"><hr /><p class="line874">Grub ends <span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><p class="line867">
<h3 id="Booting_the_.27.27CF.2FUSB.27.27_Drive">Booting the ''CF/USB'' Drive</h3>
<span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><p class="line862">At this point, you should be able to boot from the newly created media. The trick now is how to instruct your BIOS to boot from the device. On the Advantech PCM9381, I need to select HDD-1 for the CF device and USB-HDD for the USB memory stick. Unfortunately, every BIOS is different. Sometimes, it is clear from the wording of the choices, other times it is necessary to try virtually every combination until you find one that works. Once you have gotten the BIOS set up to boot from the <em>CF/USB</em> disk, grub will start and present you with the menu that you installed in the "menu.lst" file. I choose the "Text Mode" installer. The rest is standard stuff. <span class="anchor" id="line-268"></span><span class="anchor" id="bottom"></span></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" lang="en" dir="ltr">Installation/FromCForUSBStick  (last edited 2011-06-02 09:45:37 by <span title="https://login.launchpad.net/+id/hLWXLMx @ 157-157-186-230.dsl.dynamic.simnet.is[157.157.186.230]"><a class="interwiki" href="https://launchpad.net/~skovprodukter" title="https://login.launchpad.net/+id/hLWXLMx @ 157-157-186-230.dsl.dynamic.simnet.is[157.157.186.230]">skovprodukter</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/
		License">Copyright / License</a> for details<br /><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div></body>
</html>

